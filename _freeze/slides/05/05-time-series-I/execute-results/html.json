{
  "hash": "4f549678e7bb3357380032a06bf23305",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Visualizing time series data - I\nsubtitle: Lecture 5\ntitle-slide-attributes:\n  data-background-image: ../vizdata-bg.png\n  data-background-size: stretch\n  data-slide-number: none\nformat: revealjs\n---\n\n\n# Warm up\n\n## Announcements\n\n-   HW 1 due at 5 pm today\n\n-   ?\n\n## Setup {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load packages\nlibrary(countdown)\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(colorspace)\nlibrary(broom)\nlibrary(fs)\nlibrary(MoMAColors)\n\n# set theme for ggplot2\nggplot2::theme_set(ggplot2::theme_minimal(base_size = 14))\n\n# set figure parameters for knitr\nknitr::opts_chunk$set(\n  fig.width = 7, # 7\" width\n  fig.asp = 0.618, # the golden ratio\n  fig.retina = 3, # dpi multiplier for displaying HTML output on retina\n  fig.align = \"center\", # center align figures\n  dpi = 300 # higher dpi, sharper image\n)\n```\n:::\n\n\n# From last time: Bringing together multiple data frames\n\n## Data\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprofessions <- read_csv(\"data/professions.csv\")\ndates <- read_csv(\"data/dates.csv\")\nworks <- read_csv(\"data/works.csv\")\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n## Visualizing joined data\n\nThe following plot displays some information from each of the three data frames:\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](05-time-series-I_files/figure-revealjs/scientists-gantt-plot-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n## Livecoding {.smaller}\n\nReveal below for code developed during live coding session.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Transform\"}\nscientists <- professions |>\n  left_join(dates) |>\n  left_join(works)\n\nscientists_longer <- scientists |>\n  mutate(\n    birth_year = case_when(\n      name == \"Ada Lovelace\" ~ 1815,\n      name == \"Marie Curie\" ~ 1867,\n      TRUE ~ birth_year\n    ),\n    death_year = case_when(\n      name == \"Ada Lovelace\" ~ 1852,\n      name == \"Marie Curie\" ~ 1934,\n      name == \"Flossie Wong-Staal\" ~ 2020,\n      TRUE ~ death_year\n    ),\n    status = if_else(is.na(death_year), \"alive\", \"deceased\"),\n    death_year = if_else(is.na(death_year), 2021, death_year),\n    known_for = if_else(name == \"Rosalind Franklin\", \"understanding of the molecular structures of DNA \", known_for)\n  ) |>\n  pivot_longer(\n    cols = contains(\"year\"),\n    names_to = \"year_type\",\n    values_to = \"year\"\n  ) |>\n  mutate(death_year_fake = if_else(year == 2021, TRUE, FALSE))\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot\"}\nggplot(scientists_longer, \n       aes(x = year, y = fct_reorder(name, as.numeric(factor(profession))), group = name, color = profession)) +\n  geom_point(aes(shape = death_year_fake), show.legend = FALSE) +\n  geom_line(aes(linetype = status), show.legend = FALSE) +\n  scale_shape_manual(values = c(\"circle\", NA)) +\n  scale_linetype_manual(values = c(\"dashed\", \"solid\")) +\n  scale_color_moma_d(\"Lupi\") +\n  scale_x_continuous(expand = c(0.01, 0), breaks = seq(1820, 2020, 50)) +\n  geom_text(aes(y = name, label = known_for), x = 2030, show.legend = FALSE, hjust = 0) +\n  geom_text(aes(label = profession), x = 1809, y = Inf, hjust = 1, vjust = 1, show.legend = FALSE) +\n  coord_cartesian(clip = \"off\") +\n  labs(\n    x = \"Year\", y = NULL,\n    title = \"10 women in science who changed the world\",\n    caption = \"Source: Discover magazine\"\n  ) +\n  facet_grid(profession ~ ., scales = \"free_y\", space = \"free_y\", switch = \"x\") +\n  theme(\n    plot.margin = unit(c(1, 24, 1, 5), \"lines\"),\n    plot.title.position = \"plot\",\n    plot.caption.position = \"plot\",\n    plot.caption = element_text(hjust = 2), # manual hack\n    strip.background = element_blank(),\n    strip.text = element_blank(),\n    axis.title.x = element_text(hjust = 0),\n    panel.background = element_rect(fill = \"#f0f0f0\", color = \"white\"),\n    panel.grid.major = element_line(color = \"white\", linewidth = 0.5)\n  )\n```\n:::\n\n\n# Working with dates\n\n## Air Quality Index\n\n-   The AQI is the Environmental Protection Agency's index for reporting air quality\n\n-   Higher values of AQI indicate worse air quality\n\n[![](images/aqi-levels.png){fig-alt=\"AQI Basics for Ozone and Particle Pollution\"}](https://www.airnow.gov/aqi-basics)\n\n::: aside\nSource: https://www.airnow.gov/aqi-basics\n:::\n\n## AQI levels\n\nThe previous graphic in tibble form, to be used later...\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\naqi_levels <- tribble(\n  ~aqi_min, ~aqi_max, ~color,    ~level,\n  0,        50,       \"#D8EEDA\", \"Good\",\n  51,       100,      \"#F1E7D4\", \"Moderate\",\n  101,      150,      \"#F8E4D8\", \"Unhealthy for sensitive groups\",\n  151,      200,      \"#FEE2E1\", \"Unhealthy\",\n  201,      300,      \"#F4E3F7\", \"Very unhealthy\",\n  301,      400,      \"#F9D0D4\", \"Hazardous\"\n)\n```\n:::\n\n\n## AQI data\n\n-   Source: [EPA's Daily Air Quality Tracker](https://www.epa.gov/outdoor-air-quality-data/air-data-daily-air-quality-tracker)\n\n-   2016 - 2022 AQI (Ozone and PM2.5 combined) for Durham-Chapel Hill, NC core-based statistical area (CBSA), one file per year\n\n-   2016 - 2022 AQI (Ozone and PM2.5 combined) for San Francisco-Oakland-Hayward, CA CBSA, one file per year\n\n## 2022 Durham-Chapel Hill\n\n-   Load data\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndch_2022 <- read_csv(here::here(\"data/durham-chapel-hill/ad_aqi_tracker_data-2022.csv\"))\n```\n:::\n\n\n. . .\n\n-   Metadata\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndim(dch_2022)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 365  11\n```\n\n\n:::\n\n```{.r .cell-code}\nnames(dch_2022)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Date\"                       \"AQI Value\"                  \"Main Pollutant\"            \n [4] \"Site Name\"                  \"Site ID\"                    \"Source\"                    \n [7] \"20-year High (2000-2019)\"   \"20-year Low (2000-2019)\"    \"5-year Average (2015-2019)\"\n[10] \"Date of 20-year High\"       \"Date of 20-year Low\"       \n```\n\n\n:::\n:::\n\n\n## Clean variable names\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndch_2022 <- dch_2022 |>\n  janitor::clean_names()\n\nnames(dch_2022)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"date\"                      \"aqi_value\"                 \"main_pollutant\"           \n [4] \"site_name\"                 \"site_id\"                   \"source\"                   \n [7] \"x20_year_high_2000_2019\"   \"x20_year_low_2000_2019\"    \"x5_year_average_2015_2019\"\n[10] \"date_of_20_year_high\"      \"date_of_20_year_low\"      \n```\n\n\n:::\n:::\n\n\n## First look\n\n::: task\nThis plot looks quite bizarre. What might be going on?\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(dch_2022, aes(x = date, y = aqi_value, group = 1)) +\n  geom_line()\n```\n\n::: {.cell-output-display}\n![](05-time-series-I_files/figure-revealjs/unnamed-chunk-13-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n## Peek at data\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndch_2022 |>\n  select(date, aqi_value, site_name, site_id)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 365 × 4\n   date       aqi_value site_name     site_id    \n   <chr>      <chr>     <chr>         <chr>      \n 1 01/01/2022 22        Durham Armory 37-063-0015\n 2 01/02/2022 12        Durham Armory 37-063-0015\n 3 01/03/2022 10        Durham Armory 37-063-0015\n 4 01/04/2022 21        Durham Armory 37-063-0015\n 5 01/05/2022 35        Durham Armory 37-063-0015\n 6 01/06/2022 29        Durham Armory 37-063-0015\n 7 01/07/2022 15        Durham Armory 37-063-0015\n 8 01/08/2022 28        Durham Armory 37-063-0015\n 9 01/09/2022 28        Durham Armory 37-063-0015\n10 01/10/2022 15        Durham Armory 37-063-0015\n# ℹ 355 more rows\n```\n\n\n:::\n:::\n\n\n## Transforming date {.smaller}\n\nUsing `lubridate::mdy()`:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndch_2022 |>\n  mutate(date = mdy(date))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 365 × 11\n   date       aqi_value main_pollutant site_name     site_id     source x20_year_high_2000_2019\n   <date>     <chr>     <chr>          <chr>         <chr>       <chr>                    <dbl>\n 1 2022-01-01 22        PM2.5          Durham Armory 37-063-0015 AQS                        111\n 2 2022-01-02 12        PM2.5          Durham Armory 37-063-0015 AQS                         76\n 3 2022-01-03 10        PM2.5          Durham Armory 37-063-0015 AQS                         66\n 4 2022-01-04 21        PM2.5          Durham Armory 37-063-0015 AQS                         61\n 5 2022-01-05 35        PM2.5          Durham Armory 37-063-0015 AQS                         83\n 6 2022-01-06 29        PM2.5          Durham Armory 37-063-0015 AQS                         71\n 7 2022-01-07 15        PM2.5          Durham Armory 37-063-0015 AQS                         75\n 8 2022-01-08 28        PM2.5          Durham Armory 37-063-0015 AQS                         76\n 9 2022-01-09 28        PM2.5          Durham Armory 37-063-0015 AQS                         57\n10 2022-01-10 15        PM2.5          Durham Armory 37-063-0015 AQS                         71\n# ℹ 355 more rows\n# ℹ 4 more variables: x20_year_low_2000_2019 <dbl>, x5_year_average_2015_2019 <dbl>,\n#   date_of_20_year_high <chr>, date_of_20_year_low <chr>\n```\n\n\n:::\n:::\n\n\n## Transforming AQI values {.smaller}\n\n::: task\nWhat does this warning mean?\n:::\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndch_2022 |>\n  mutate(aqi_value = as.numeric(aqi_value))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 365 × 11\n  date       aqi_value main_pollutant site_name     site_id     source x20_year_high_2000_2019\n  <chr>          <dbl> <chr>          <chr>         <chr>       <chr>                    <dbl>\n1 01/01/2022        22 PM2.5          Durham Armory 37-063-0015 AQS                        111\n2 01/02/2022        12 PM2.5          Durham Armory 37-063-0015 AQS                         76\n3 01/03/2022        10 PM2.5          Durham Armory 37-063-0015 AQS                         66\n# ℹ 362 more rows\n# ℹ 4 more variables: x20_year_low_2000_2019 <dbl>, x5_year_average_2015_2019 <dbl>,\n#   date_of_20_year_high <chr>, date_of_20_year_low <chr>\n```\n\n\n:::\n:::\n\n\n\n\n## Investigating AQI values {.smaller}\n\n-   Take a peek at distinct values of AQI\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndch_2022 |>\n  distinct(aqi_value) |>\n  pull()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"22\" \"12\" \"10\" \"21\" \"35\" \"29\" \"15\" \"28\" \"25\" \"36\" \"49\" \"19\" \"24\" \"46\" \"38\" \"48\" \"34\" \"47\" \"57\"\n[20] \"26\" \"45\" \"42\" \"13\" \"31\" \"39\" \"62\" \"40\" \"30\" \"20\" \"18\" \"27\" \"67\" \"41\" \"56\" \"37\" \"32\" \"43\" \"51\"\n[39] \"50\" \"44\" \"33\" \"54\" \"52\" \"77\" \"74\" \"53\" \"58\" \"64\" \"61\" \"93\" \"16\" \"17\" \"23\" \"5\"  \"6\"  \".\"  \"9\" \n[58] \"14\" \"59\"\n```\n\n\n:::\n:::\n\n\n-   `\".\"` likely indicates `NA`, and it's causing the entire column to be read in as characters\n\n## Rewind, and start over {.smaller}\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndch_2022 <- read_csv(\n  here::here(\"data/durham-chapel-hill/ad_aqi_tracker_data-2022.csv\"),\n  na = c(\".\", \"\")\n)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nglimpse(dch_2022)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 365\nColumns: 11\n$ Date                         <chr> \"01/01/2022\", \"01/02/2022\", \"01/03/2022\", \"01/04/2022\", \"01/0…\n$ `AQI Value`                  <dbl> 22, 12, 10, 21, 35, 29, 15, 28, 28, 15, 25, 36, 49, 35, 28, 1…\n$ `Main Pollutant`             <chr> \"PM2.5\", \"PM2.5\", \"PM2.5\", \"PM2.5\", \"PM2.5\", \"PM2.5\", \"PM2.5\"…\n$ `Site Name`                  <chr> \"Durham Armory\", \"Durham Armory\", \"Durham Armory\", \"Durham Ar…\n$ `Site ID`                    <chr> \"37-063-0015\", \"37-063-0015\", \"37-063-0015\", \"37-063-0015\", \"…\n$ Source                       <chr> \"AQS\", \"AQS\", \"AQS\", \"AQS\", \"AQS\", \"AQS\", \"AQS\", \"AQS\", \"AQS\"…\n$ `20-year High (2000-2019)`   <dbl> 111, 76, 66, 61, 83, 71, 75, 76, 57, 71, 81, 77, 62, 63, 68, …\n$ `20-year Low (2000-2019)`    <dbl> 10, 8, 14, 9, 8, 15, 18, 15, 19, 20, 14, 5, 16, 15, 0, 6, 2, …\n$ `5-year Average (2015-2019)` <dbl> 39.2, 36.8, 38.2, 30.4, 26.0, 32.4, 37.0, 36.6, 35.0, 35.6, 4…\n$ `Date of 20-year High`       <chr> \"01/01/2000\", \"01/02/2005\", \"01/03/2004\", \"01/04/2008\", \"01/0…\n$ `Date of 20-year Low`        <chr> \"01/01/2007\", \"01/02/2012\", \"01/03/2012\", \"01/04/2007\", \"01/0…\n```\n\n\n:::\n:::\n\n\n## Data cleaning\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndch_2022 <- dch_2022 |>\n  janitor::clean_names() |>\n  mutate(date = mdy(date))\n\ndch_2022\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 365 × 11\n   date       aqi_value main_pollutant site_name     site_id     source x20_year_high_2000_2019\n   <date>         <dbl> <chr>          <chr>         <chr>       <chr>                    <dbl>\n 1 2022-01-01        22 PM2.5          Durham Armory 37-063-0015 AQS                        111\n 2 2022-01-02        12 PM2.5          Durham Armory 37-063-0015 AQS                         76\n 3 2022-01-03        10 PM2.5          Durham Armory 37-063-0015 AQS                         66\n 4 2022-01-04        21 PM2.5          Durham Armory 37-063-0015 AQS                         61\n 5 2022-01-05        35 PM2.5          Durham Armory 37-063-0015 AQS                         83\n 6 2022-01-06        29 PM2.5          Durham Armory 37-063-0015 AQS                         71\n 7 2022-01-07        15 PM2.5          Durham Armory 37-063-0015 AQS                         75\n 8 2022-01-08        28 PM2.5          Durham Armory 37-063-0015 AQS                         76\n 9 2022-01-09        28 PM2.5          Durham Armory 37-063-0015 AQS                         57\n10 2022-01-10        15 PM2.5          Durham Armory 37-063-0015 AQS                         71\n# ℹ 355 more rows\n# ℹ 4 more variables: x20_year_low_2000_2019 <dbl>, x5_year_average_2015_2019 <dbl>,\n#   date_of_20_year_high <chr>, date_of_20_year_low <chr>\n```\n\n\n:::\n:::\n\n\n## Another look\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(dch_2022, aes(x = date, y = aqi_value, group = 1)) +\n  geom_line()\n```\n\n::: {.cell-output-display}\n![](05-time-series-I_files/figure-revealjs/dch-2022-1-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n::: task\nHow would you improve this visualization?\n:::\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](05-time-series-I_files/figure-revealjs/unnamed-chunk-25-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n## Visualizing Durham AQI\n\n::: task\nRecreate the following visualization.\n:::\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](05-time-series-I_files/figure-revealjs/dch-2022-2-1.png){fig-align='center' width=2100}\n:::\n:::\n\n````{=html}\n<!--\n\n## Livecoding {.smaller}\n\nReveal below for code developed during live coding session.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\naqi_levels <- aqi_levels |>\n  mutate(aqi_mid = ((aqi_min + aqi_max) / 2))\n\ndch_2022 |>\n  filter(!is.na(aqi_value)) |>\n  ggplot(aes(x = date, y = aqi_value, group = 1)) +\n  geom_rect(\n    data = aqi_levels,\n    aes(\n      ymin = aqi_min, ymax = aqi_max,\n      xmin = as.Date(-Inf), xmax = as.Date(Inf),\n      fill = color, y = NULL, x = NULL\n    )\n  ) +\n  geom_line(linewidth = 1) +\n  scale_fill_identity() +\n  scale_x_date(\n    name = NULL, date_labels = \"%b\",\n    limits = c(ymd(\"2022-01-01\"), ymd(\"2023-03-01\"))\n  ) +\n  geom_text(\n    data = aqi_levels,\n    aes(x = ymd(\"2023-02-28\"), y = aqi_mid, label = level),\n    hjust = 1, size = 6, fontface = \"bold\", color = \"white\"\n  ) +\n  annotate(\n    geom = \"text\",\n    x = c(ymd(\"2022-01-01\"), ymd(\"2023-03-01\")), y = -100,\n    label = c(\"2022\", \"2023\"), size = 4\n  ) +\n  coord_cartesian(clip = \"off\", ylim = c(0, 400)) +\n  labs(\n    x = NULL, y = \"AQI\",\n    title = \"Ozone and PM2.5 Daily AQI Values\",\n    subtitle = \"Durham-Chapel Hill, NC\",\n    caption = \"\\nSource: EPA Daily Air Quality Tracker\"\n  ) +\n  theme(\n    plot.title.position = \"plot\",\n    panel.grid.minor.y = element_blank(),\n    panel.grid.minor.x = element_blank(),\n    plot.margin = unit(c(1, 1, 3, 1), \"lines\")\n  )\n```\n:::\n\n-->\n````\n",
    "supporting": [
      "05-time-series-I_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}