---
title: Interactive reporting + visualization with Shiny
subtitle: Lecture 18
title-slide-attributes:
  data-background-image: ../vizdata-bg.png
  data-background-size: stretch
  data-slide-number: none
format: revealjs
---

# Warm up

## Announcements

-   HW 5 is posted, due next Tuesday, work on it in lab tomorrow

## Setup {.smaller}

```{r}
#| label: setup
#| message: false

# load packages
library(tidyverse)

# set figure parameters for knitr
knitr::opts_chunk$set(
  fig.width = 7, # 7" width
  fig.asp = 0.618, # the golden ratio
  fig.retina = 3, # dpi multiplier for displaying HTML output on retina
  fig.align = "center", # center align figures
  dpi = 300 # higher dpi, sharper image
)
```

# Shiny: High level view

## Shiny {.center}

Every Shiny app has a webpage that the user visits, <br> and behind this webpage there is a computer that serves this webpage by running R.

```{r echo = FALSE, out.width = "80%"}
knitr::include_graphics("images/high-level-1.png")
```

## Shiny {.center}

When running your app locally, the computer serving your app is your computer.

```{r echo = FALSE, out.width = "100%"}
knitr::include_graphics("images/high-level-2.png")
```

## Shiny {.center}

When your app is deployed, the computer serving your app is a web server.

```{r echo = FALSE, out.width = "100%"}
knitr::include_graphics("images/high-level-3.png")
```

## Shiny {.center}

```{r echo = FALSE, out.width = "100%"}
knitr::include_graphics("images/high-level-4.png")
```

## Demo

```{r}
#| echo: false
#| fig-align: center
#| out-width: "100%"
knitr::include_app("https://gallery.shinyapps.io/goog-trend-index/", height = "650px")
```

# Anatomy of a Shiny app

## What's in an app?

::: columns
::: {.column width="50%"}
```{r eval = FALSE}
library(shiny)
ui <- fluidPage()


server <- function(
    input, 
    output, 
    session) {
  ...
}


shinyApp(
  ui = ui, 
  server = server
)
```
:::

::: {.column width="50%"}
-   **User interface** controls the layout and appearance of app

-   **Server function** contains instructions needed to build app
:::
:::

## Data: Ask a manager

Source: Ask a Manager Survey via [TidyTuesday](https://github.com/rfordatascience/tidytuesday/tree/master/data/2021/2021-05-18)

> This data does not reflect the general population; it reflects Ask a Manager readers who self-selected to respond, which is a very different group (as you can see just from the demographic breakdown below, which is very white and very female).

Some findings [here](https://www.askamanager.org/2021/05/some-findings-from-24000-peoples-salaries.html).

## Data: `manager`

```{r}
#| message: false
manager <- read_csv("data/survey.csv")
manager
```

## Ultimate goal

::: {.medium .center-align}
[https://minecr.shinyapps.io/manager-survey](https://minecr.shinyapps.io/manager-survey/)
:::

```{r}
#| echo: false
knitr::include_app("https://minecr.shinyapps.io/manager-survey/", height ="550px")
```

# Interactive reporting with Shiny

## Livecoding

::: task
Go to the `ae-13` project and code along in `manager-survey/app-1.R`.
:::

<br>

Highlights:

-   Data pre-processing
-   Basic reactivity

## Livecoding

::: task
Go to the `ae-21` project and code along in `manager-survey/app-2.R`.
:::

<br>

Highlights:

-   Data pre-processing outside of the app
-   Tabsets
-   Validation

# Interactive visualizations with Shiny

## Livecoding

::: task
Go to the `ae-21` project and code along in `manager-survey/app-3.R`.
:::

<br>

Highlights:

-   Conditional panels
-   Linked brushing

## Reference

The code for the app can be found [here](https://github.com/vizdata-s23/vizdata-s23/blob/main/slides/26/manager-survey/app.R).
